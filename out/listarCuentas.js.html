<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: listarCuentas.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: listarCuentas.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>$(document).ready(function () {
    inicio();
});
var item = $('#item').val();
var dominio;
var dinero;
var paginador= document.getElementsByName("paginador")[0];
var nList = 0;
var allCuentas;
var l;
var list="";
var tabla = "";
var filtrado=[];
var p = document.getElementById("p");
var conection= new clsConection;
var cuentas;
var longCuentas;


/**
 * @function inicio
 * @description Activa eventos escucha e inicia la aplicación.
 */
/////////////////////////////////////////////////////////////////
function inicio() {
    var array={
        'method': 'select',
        'campo' : '*',
         'tabla' : 'cuentas',
    };
    if(validarUser() == 'admin' || validarUser() == 'consult'){
        conection.setRequest(array);
        conection.callServer();
        cuentas= conection.getRespuesta();

        $('#dominio').change(changeDominio);
        $('#dinero').change(changeDinero);
        $('#item').change(cleanTable);
        $('#saveChanges').click(saveChanges);

        filtrado= cuentas;
        setDominio();
        setDinero();
        setLongCuentas();
        crearTabla();
    }
}
/**
 * @function validarUser
 * @description Devuelve el tipo de usuario logueado, sino lo hay, devuelve un false
 * @returns string
 */
 function validarUser(){
    if(clsCookies.ReadCookie('Sesion') == 'admin'){
        return 'admin';
    }if(clsCookies.ReadCookie('Sesion') == 'consult'){
        return 'consult';
    }
    return 'false';
}
/**
 * @function listen 
 * @param {int} num 
 * @description Crea eventos escucha de los botones de paginación.
 */
/////////////////////////////////////////////////////////////////
function listen(num){
    for(i=0; i&lt;=num-1; i++){
        document.getElementsByName("paginador")[i].addEventListener('click', changeTable, false);
    }
}
/**
 * @function listenValores
 * @param {int} valor
 * @description Genera eventos escucha de los elementos de la tabla. 
 * Eventos de si son modificados.
 */
/////////////////////////////////////////////////////////////////
function listenValores(valor){
    list="Cambios efectuados\n";

    $('.link').change(changeList);
    $('.user').change(changeList);
    $('.email').change(changeList);
    $('.money').change(changeList);
    $('.pwd').change(changeList);
    $('.coment').change(changeList);
    $('.delete').click(deleteAccount);
    $('.modifiClient').click(gotoModificar);

}
/////////////////////////////////////////////////////////////////
function disabled(){
    $('.link').prop('disabled', true);
    $('.user').prop('disabled', true);
    $('.email').prop('disabled', true);
    $('.money').prop('disabled', true);
    $('.pwd').prop('disabled', true);
    $('.coment').prop('disabled', true);
}
/**
 * @function gotoModificar
 * @description Coge la cuenta seleccionada para modificar y la manda al html padre
 */
/////////////////////////////////////////////////////////////////
function gotoModificar(){
    if(validarUser() == 'admin'){
        id= this.value;
        //Hacemos un foreach para buscar el cliente con el mismo id
        function iterate(visit) {
            if(visit.id == id){
                cuentaSend= visit;
            }
        }
        cuentas.forEach(iterate);

        var event = new CustomEvent('modificarCuenta', {detail : cuentaSend});
        parent.document.dispatchEvent(event);
    }else{
        alert('No tienes permisos para esta accion');
    }
}
//detach() guarda los datos y borra el elemento.
//empty() Borra los hijos de ese elemento.
/**
 * @function paginator
 * @description Genera los botones de paginación. 
 */
/////////////////////////////////////////////////////////////////
function paginator(){
    numPage= Math.ceil(longCuentas / getItem());
    padre= document.getElementById("lista");

    for(i=2; i&lt;=numPage; i++){
        element= paginador.cloneNode("paginador");
        element.value= i;
        padre.appendChild(element);
    }

    listen(numPage);
}
/**
 * @function deletePaginator
 * @description Elimina el paginador.
 */
/////////////////////////////////////////////////////////////////
function deletePaginator(){
    padre = document.getElementById("lista"); //$('#lista');
    long = document.getElementsByName("paginador").length;

    for (i = 1; i &lt;= long - 1; i++) {
        element = document.getElementsByName("paginador")[1];
        padre.removeChild(element);
    }
}
/**
 * @function deleteAccount
 * @description Elimina a un cliente del json local.
 */
/////////////////////////////////////////////////////////////////
function deleteAccount(){
    if(validarUser() == 'admin'){
        element= this;
        id= this.parentNode.parentNode.firstChild.firstChild.value;

        var info={
            'method': 'delete',
            'tabla' : 'cuentas',
            'condition' : 'link',
            'id' : id
        };
        //funciona
        conection.setRequest(info);
        conection.callServer();
        for(i=0; i&lt;=longCuentas; i++){
            if(cuentas[i].link == id){
                cuentas.splice( i, 1 );
                i=20;
            }
        }
        setLongCuentas();
        $(this).parents('tr').first().remove();
    }else{
        alert('No tienes permisos para esta accion');
    }
}
/**
 * @function changeTable
 * @description Cambia la tabla segun el numero del paginador que se pulsa.
 * Calcula el numero de la lista(arrayCuentas) que debe ser el primero de la tabla.
 */
/////////////////////////////////////////////////////////////////
function changeTable(){
    page= this.value;
    nList= item * (page-1);
    deletePaginator();
    crearTabla();
}
/**
 * @function cleanTable
 * @description Elimina la tabla y el paginador y vuelve a crear una tabla.
 */
/////////////////////////////////////////////////////////////////
function cleanTable() {
    element = $('#tabla'); //document.getElementById("tabla");
    element.remove();
    deletePaginator();
    crearTabla();
}
/**
 * @function crearTabla
 * @description Crea la tabla según los valores que haya seleccionados en ese instante.
 */
/////////////////////////////////////////////////////////////////
function crearTabla() {
    setItem();
    inicioTabla();
    allCuentas= parseInt(nList) + parseInt(item);
    
    if(allCuentas >= longCuentas){
        l= longCuentas - nList;

        for (i = 1; i &lt;= l; i++) {
            generarItem();
            item=i;      
        }

    }else{
        for (i = 1; i &lt;= item; i++) {
            generarItem();
        }
    }
    
    finalTabla();
    p.innerHTML = tabla;
    loadData();
    listenValores(item);
    paginator();
    disabled();
}
/**
 * @function find
 * @description Busca que filtros estan seleccionados.
 */
/////////////////////////////////////////////////////////////////
function find(){
    if(dominio === "" &amp; dinero === 0){
        restartTable();
        return;
    }
    if(dominio === "" || dinero === 0){
        filtrar(true);
    }else if(dominio != "" &amp; dinero > 0){
        filtrar(false);
    }

    longCuentas= filtrado.length;

    if(longCuentas == 0){
        alert("No hay ninguna cluenta con esos requisitos");
        restartTable();
        return;
    }
    cleanTable();
}
/**
 * @function filtrar
 * @param {boolean} condicion
 * @description Filtra las cuentas que cumplen las condiciones de los filtros de busqueda establecidos.
 */
/////////////////////////////////////////////////////////////////
function filtrar(condicion){
    t=0;
    filtrado=[];
    if(condicion){
        for(i=0; i&lt;=longCuentas-1; i++){
            if(cuentas[i]._link.includes(dominio) &amp; dominio !="" || (cuentas[i]._money >= dinero &amp; dinero > 0)){
                filtrado[t]= cuentas[i];
                t++;
            }
        }
    }else if(!condicion){
        for(i=0; i&lt;=longCuentas-1; i++){
            if( cuentas[i]._link.includes(dominio) &amp; cuentas[i]._money >= dinero){
                filtrado[t]= cuentas[i];
                t++;
            }
        }
    }
}
/**
 * @function inicioTabla
 * @description Genera el principio de la tabla y lo guarda en la variable tabla. 
 */
/////////////////////////////////////////////////////////////////
function inicioTabla() {
    tabla = "&lt;table id=tabla class=blueTable>&lt;tbody class=centro name=table>&lt;tr>&lt;th>Link&lt;/th>&lt;th>userName&lt;/th>&lt;th>Email&lt;/th>&lt;th>Money&lt;/th>&lt;th>Pwd&lt;/th>&lt;th>Comentario&lt;/th>&lt;/tr>";

}
/**
 * @function generarItem
 * @description Añade a la variable tabla una fila completa por cada llamada.
 */
/////////////////////////////////////////////////////////////////
function generarItem() {
    tabla += "&lt;tr>&lt;td>&lt;input class=link name=link type=text>&lt;/td>&lt;td>&lt;input class=user name=user type=text>&lt;/td>&lt;td>&lt;input class=email name=email type=email>&lt;/td>&lt;td>&lt;input class=money name=money type=number>&lt;/td>&lt;td>&lt;input class=pwd name=pwd type=text>&lt;/td>&lt;td>&lt;input class=coment name=coment type=text>&lt;/td>&lt;td>&lt;a class=modifiClient type=button name=modifiClient value=''>Modificar&lt;/a>&lt;/td>&lt;td>&lt;input class=delete type=button name=delete value=Borrar>&lt;/td>&lt;/tr>";
    //modifiClient
}
/**
 * @function finalTabla
 * @description Añade el final de la tabla a la variable tabla.
 */
/////////////////////////////////////////////////////////////////
function finalTabla() {
    tabla += "&lt;/tbody>&lt;/table>";
}
/**
 * @function restartTable
 * @description Esta función se ejecuta en caso de error, reinicia la tabla.
 */
/////////////////////////////////////////////////////////////////
function restartTable(){
    filtrado= cuentas;
    setLongCuentas();
    restartFiltros();
    cleanTable();
}
/**
 * @function restartFiltros
 * @description Restableze los filtros de busqueda.
 */
function restartFiltros(){
    document.getElementById("dominio").options.item(0).selected = 'selected';
    document.getElementById("dinero").options.item(0).selected = 'selected';
    //dominio= $('#dominio').val();
    setDominio();
    setDinero();
    //dinero= $('#dinero').val();
}
/**
 * @function loadData
 * @description Carga los datos de las cuentas en la tabla.
 */
/////////////////////////////////////////////////////////////////
function loadData() {
    padre = document.getElementsByName("table")[0];
    var n= nList;
    for (i = 0; i &lt;= item - 1; i++) {
        if(!filtrado[i]){
            n++;
        }else{
            document.getElementsByName("modifiClient")[i].value = filtrado[n].id;
            document.getElementsByName("link")[i].value = filtrado[n].link;
            document.getElementsByName("user")[i].value = filtrado[n].user_name;
            document.getElementsByName("email")[i].value = filtrado[n].email;
            document.getElementsByName("money")[i].value = filtrado[n].money;
            document.getElementsByName("pwd")[i].value = filtrado[n].pwd;
            document.getElementsByName("coment")[i].value = filtrado[n].comentario;
            n++;
        }
    }
}
/**
 * @function changeList
 * @description Genera una lista con los cambios efectuados.
 */
/////////////////////////////////////////////////////////////////
function changeList(){
    element= this;
    id= this.parentNode.parentNode.firstChild.firstChild.value;

    list+= "Al user: "+ id +". Se ha modificado su "+ element.name + " a: " + element.value + "\n";
}
/**
 * @function saveChanges
 * @description Muestra por consola la lista de cambios efectuados.
 */
/////////////////////////////////////////////////////////////////
function saveChanges(){
    //console.log(list);
}
/**
 * @function changeCuenta
 * @description Guarda el valor del filtro cuenta y ejecuta su busqueda.
 */
/////////////////////////////////////////////////////////////////
function changeDominio() {
    setLongCuentas();
    setDominio();
    find();
}
/**
 * @function setDominio
 * @description Actualiza el valor del dominio.
 */
/////////////////////////////////////////////////////////////////
function setDominio(){
    dominio = $('#dominio').val();
    //document.getElementById("cuenta").value;
}

/**
 * @function changeDinero
 * @description Guarda el valor del filtro cliente y ejecuta su busqueda.
 */
/////////////////////////////////////////////////////////////////
function changeDinero() {
    setLongCuentas();
    setDinero();
    find();
}
/**
 * @function setDinero
 * @description Actualiza el valor de Tipo Email.
 */
/////////////////////////////////////////////////////////////////
function setDinero(){
    dinero = parseInt( $('#dinero').val());
}

/**
 * @function setItem
 * @description Controla el valor de cuantas Cuentas se quieren visualizar por pagina.
 */
/////////////////////////////////////////////////////////////////
function setItem() {
    item = $('#item').val();
    //document.getElementById("item").value;
}
/**
 * @function getItem
 * @description Devuelve el valor de el numero de Cuentas que se quieren por pagina.
 */
/////////////////////////////////////////////////////////////////
function getItem() {
    setItem();
    return item;
}
/**
 * @function setLongCuentas
 * @description Iguala la variable longitud cuentas a la longitud del array de cuentas.
 */
/////////////////////////////////////////////////////////////////
function setLongCuentas(){
    longCuentas= cuentas.length;
}
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#changeCuenta">changeCuenta</a></li><li><a href="global.html#changeDinero">changeDinero</a></li><li><a href="global.html#changeList">changeList</a></li><li><a href="global.html#changeTable">changeTable</a></li><li><a href="global.html#cleanTable">cleanTable</a></li><li><a href="global.html#crearTabla">crearTabla</a></li><li><a href="global.html#deleteAccount">deleteAccount</a></li><li><a href="global.html#deletePaginator">deletePaginator</a></li><li><a href="global.html#filtrar">filtrar</a></li><li><a href="global.html#finalTabla">finalTabla</a></li><li><a href="global.html#find">find</a></li><li><a href="global.html#formAlphanumeric">formAlphanumeric</a></li><li><a href="global.html#generarItem">generarItem</a></li><li><a href="global.html#getItem">getItem</a></li><li><a href="global.html#gotoModificar">gotoModificar</a></li><li><a href="global.html#inicio">inicio</a></li><li><a href="global.html#inicioTabla">inicioTabla</a></li><li><a href="global.html#link">link</a></li><li><a href="global.html#listen">listen</a></li><li><a href="global.html#listenValores">listenValores</a></li><li><a href="global.html#loadData">loadData</a></li><li><a href="global.html#paginator">paginator</a></li><li><a href="global.html#recibirCuenta">recibirCuenta</a></li><li><a href="global.html#restartFiltros">restartFiltros</a></li><li><a href="global.html#restartTable">restartTable</a></li><li><a href="global.html#saveChanges">saveChanges</a></li><li><a href="global.html#sendAccount">sendAccount</a></li><li><a href="global.html#setDinero">setDinero</a></li><li><a href="global.html#setDominio">setDominio</a></li><li><a href="global.html#setItem">setItem</a></li><li><a href="global.html#setLongCuentas">setLongCuentas</a></li><li><a href="global.html#validarUser">validarUser</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.6</a> on Sun May 16 2021 19:35:56 GMT+0200 (hora de verano de Europa central)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
